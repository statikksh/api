# Migration `20200615040332-project-builds`

This migration has been generated by 7wf at 6/15/2020, 4:03:32 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "ProjectBuildStage" AS ENUM ('RUNNING', 'SUCCESS', 'FAILED');

CREATE TABLE "public"."ProjectBuild" (
"id" text  NOT NULL ,"projectId" text  NOT NULL ,"stage" "ProjectBuildStage" NOT NULL DEFAULT E'RUNNING',"startedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."ProjectBuild" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200612202439-change-project-id-type-from-int-to-string..20200615040332-project-builds
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
     provider = "postgresql"
-    url = "***"
+    url      = env("DATABASE_URL")
 }
 model User {
     id        Int    @default(autoincrement()) @id
@@ -14,10 +14,25 @@
     password  String
 }
 model Project {
-    id         String @default(uuid()) @id
-    name       String @unique
+    id         String         @default(uuid()) @id
+    name       String         @unique
     repository String
     ownerId    Int
-    owner      User @relation(fields: [ownerId], references: [id])
+    owner      User           @relation(fields: [ownerId], references: [id])
+    builds     ProjectBuild[]
 }
+
+model ProjectBuild {
+    id         String            @default(uuid()) @id
+    projectId  String
+    project    Project           @relation(fields: [projectId], references: [id])
+    stage      ProjectBuildStage @default(RUNNING)
+    startedAt  DateTime          @default(now())
+}
+
+enum ProjectBuildStage {
+    RUNNING
+    SUCCESS
+    FAILED
+}
```


